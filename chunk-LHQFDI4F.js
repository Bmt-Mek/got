import{Lb as x,Mb as m,P as u,Rc as c,Sc as h,T as v,W as d,cd as p,dd as y,g as f,m as l,n as k,p as F,w as n}from"./chunk-TGLPQRFT.js";var g=y("favorites"),j=p(g,s=>s.favorites),L=p(g,s=>s.loading),C=p(g,s=>s.error),w=p(j,s=>s.length),K=s=>p(j,r=>r.some(I=>I.url===s));var N=c("[Favorites] Load Favorites"),H=c("[Favorites] Load Favorites Success",h()),O=c("[Favorites] Load Favorites Failure",h()),P=c("[Favorites] Add To Favorites",h()),z=c("[Favorites] Add To Favorites Success",h()),R=c("[Favorites] Add To Favorites Failure",h()),J=c("[Favorites] Remove From Favorites",h()),D=c("[Favorites] Remove From Favorites Success",h()),G=c("[Favorites] Remove From Favorites Failure",h()),M=c("[Favorites] Clear Favorites");var i={production:!0,apiUrl:"https://anapioficeandfire.com/api",backendUrl:"https://got-backend.onrender.com/api",appName:"Game of Thrones Character Explorer",itemsPerPage:10,enableLogging:!1,enableDevtools:!1};var Z=(()=>{let r=class r{constructor(e){this.http=e,this.baseUrl=i.apiUrl}getCharacters(e=1,t){let o=new x().set("page",e.toString()).set("pageSize",i.itemsPerPage.toString());return t&&(t.name&&(o=o.set("name",t.name)),t.gender&&(o=o.set("gender",t.gender)),t.culture&&(o=o.set("culture",t.culture)),t.born&&(o=o.set("born",t.born)),t.died&&(o=o.set("died",t.died)),t.isAlive!==void 0&&(o=o.set("isAlive",t.isAlive.toString()))),this.http.get(`${this.baseUrl}/characters`,{params:o,observe:"response"}).pipe(F(a=>{let S=a.body||[],A=a.headers.get("Link"),b=this.extractTotalFromLinkHeader(A)||S.length;return{data:S,total:b,page:e,pageSize:i.itemsPerPage,hasNext:e*i.itemsPerPage<b,hasPrev:e>1}}),n(a=>(console.error("Error fetching characters:",a),l({data:[],total:0,page:e,pageSize:i.itemsPerPage,hasNext:!1,hasPrev:!1}))))}getCharacterById(e){return this.http.get(`${this.baseUrl}/characters/${e}`).pipe(n(t=>{throw console.error("Error fetching character:",t),t}))}searchCharacters(e){let t={name:e};return this.getCharacters(1,t)}extractTotalFromLinkHeader(e){if(!e)return null;let t=e.match(/page=(\d+)[^>]*>;\s*rel="last"/);return t?parseInt(t[1],10)*i.itemsPerPage:null}extractCharacterIdFromUrl(e){let t=e.split("/");return t[t.length-1]||""}getCharacterDisplayName(e){if(e.name&&e.name.trim())return e.name;if(e.aliases&&e.aliases.length>0){let t=e.aliases.find(o=>o&&o.trim());if(t)return t}return"Unknown Character"}isCharacterAlive(e){return!e.died||e.died.trim()===""}};r.\u0275fac=function(t){return new(t||r)(d(m))},r.\u0275prov=v({token:r,factory:r.\u0275fac,providedIn:"root"});let s=r;return s})();var oe=(()=>{let r=class r{constructor(e){this.http=e,this.tokenKey="got-auth-token",this.userKey="got-user",this.isAuthenticatedSubject=new f(!1),this.currentUserSubject=new f(null),this.initializeAuth()}login(e){return this.http.post(`${i.backendUrl}/auth/login`,e).pipe(u(t=>this.handleAuthSuccess(t)),n(t=>{throw console.error("Login error:",t),t}))}register(e){return this.http.post(`${i.backendUrl}/auth/register`,e).pipe(u(t=>this.handleAuthSuccess(t)),n(t=>{throw console.error("Registration error:",t),t}))}logout(){this.removeToken(),this.removeUser(),this.isAuthenticatedSubject.next(!1),this.currentUserSubject.next(null)}getCurrentUser(){let e=this.getStoredUser();return e&&this.getToken()?(this.currentUserSubject.next(e),l(e)):this.getToken()?this.http.get(`${i.backendUrl}/auth/me`).pipe(u(t=>{this.setUser(t),this.currentUserSubject.next(t),this.isAuthenticatedSubject.next(!0)}),n(t=>{throw console.error("Error fetching current user:",t),this.logout(),t})):k(()=>"No authentication token found")}isAuthenticated(){return this.isAuthenticatedSubject.asObservable()}getToken(){try{return localStorage.getItem(this.tokenKey)}catch(e){return console.error("Error retrieving token:",e),null}}setToken(e){try{localStorage.setItem(this.tokenKey,e)}catch(t){console.error("Error storing token:",t)}}removeToken(){try{localStorage.removeItem(this.tokenKey)}catch(e){console.error("Error removing token:",e)}}handleAuthSuccess(e){this.setToken(e.token),this.setUser(e.user),this.isAuthenticatedSubject.next(!0),this.currentUserSubject.next(e.user)}setUser(e){try{localStorage.setItem(this.userKey,JSON.stringify(e))}catch(t){console.error("Error storing user:",t)}}getStoredUser(){try{let e=localStorage.getItem(this.userKey);return e?JSON.parse(e):null}catch(e){return console.error("Error retrieving stored user:",e),null}}removeUser(){try{localStorage.removeItem(this.userKey)}catch(e){console.error("Error removing user:",e)}}initializeAuth(){let e=this.getToken(),t=this.getStoredUser();e&&t&&(this.isAuthenticatedSubject.next(!0),this.currentUserSubject.next(t))}};r.\u0275fac=function(t){return new(t||r)(d(m))},r.\u0275prov=v({token:r,factory:r.\u0275fac,providedIn:"root"});let s=r;return s})();var ce=(()=>{let r=class r{constructor(e){this.http=e,this.localStorageKey="got-favorites",this.favoritesSubject=new f([]),this.useBackend=!1,this.loadFavoritesFromStorage()}getFavorites(){return this.useBackend?this.http.get(`${i.backendUrl}/favorites`).pipe(u(e=>this.favoritesSubject.next(e)),n(e=>(console.error("Error fetching favorites from backend:",e),this.getFavoritesFromStorage()))):this.getFavoritesFromStorage()}addToFavorites(e){return this.useBackend?this.http.post(`${i.backendUrl}/favorites`,e).pipe(u(()=>{let t=this.favoritesSubject.value;this.favoritesSubject.next([...t,e])}),n(t=>(console.error("Error adding to favorites on backend:",t),this.addToFavoritesLocally(e)))):this.addToFavoritesLocally(e)}removeFromFavorites(e){return this.useBackend?this.http.delete(`${i.backendUrl}/favorites/${encodeURIComponent(e)}`).pipe(u(()=>{let o=this.favoritesSubject.value.filter(a=>a.url!==e);this.favoritesSubject.next(o)}),n(t=>(console.error("Error removing from favorites on backend:",t),this.removeFromFavoritesLocally(e)))):this.removeFromFavoritesLocally(e)}isFavorite(e){return this.favoritesSubject.asObservable().pipe(F(t=>t.some(o=>o.url===e)))}clearFavorites(){return this.useBackend?this.http.delete(`${i.backendUrl}/favorites`).pipe(u(()=>{this.favoritesSubject.next([]),this.clearFavoritesFromStorage()}),n(e=>(console.error("Error clearing favorites on backend:",e),this.clearFavoritesLocally()))):this.clearFavoritesLocally()}setUseBackend(e){this.useBackend=e,e||this.loadFavoritesFromStorage()}getFavoritesFromStorage(){let e=this.loadFavoritesFromStorage();return this.favoritesSubject.next(e),l(e)}addToFavoritesLocally(e){let t=this.loadFavoritesFromStorage();if(!t.some(a=>a.url===e.url)){let a=[...t,e];this.saveFavoritesToStorage(a),this.favoritesSubject.next(a)}return l(void 0)}removeFromFavoritesLocally(e){let o=this.loadFavoritesFromStorage().filter(a=>a.url!==e);return this.saveFavoritesToStorage(o),this.favoritesSubject.next(o),l(void 0)}clearFavoritesLocally(){return this.clearFavoritesFromStorage(),this.favoritesSubject.next([]),l(void 0)}loadFavoritesFromStorage(){try{let e=localStorage.getItem(this.localStorageKey);return e?JSON.parse(e):[]}catch(e){return console.error("Error loading favorites from localStorage:",e),[]}}saveFavoritesToStorage(e){try{localStorage.setItem(this.localStorageKey,JSON.stringify(e))}catch(t){console.error("Error saving favorites to localStorage:",t)}}clearFavoritesFromStorage(){try{localStorage.removeItem(this.localStorageKey)}catch(e){console.error("Error clearing favorites from localStorage:",e)}}};r.\u0275fac=function(t){return new(t||r)(d(m))},r.\u0275prov=v({token:r,factory:r.\u0275fac,providedIn:"root"});let s=r;return s})();export{j as a,L as b,C as c,w as d,K as e,N as f,H as g,O as h,P as i,z as j,R as k,J as l,D as m,G as n,M as o,i as p,oe as q,Z as r,ce as s};
