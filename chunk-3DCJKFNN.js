import{Lb as x,Mb as m,P as u,Sc as c,T as v,Tc as h,W as d,dd as p,ed as y,g as f,m as l,n as k,p as F,w as n}from"./chunk-HZCOYSZS.js";var g=y("favorites"),j=p(g,s=>s.favorites),L=p(g,s=>s.loading),C=p(g,s=>s.error),w=p(j,s=>s.length),K=s=>p(j,r=>r.some(I=>I.url===s));var N=c("[Favorites] Load Favorites"),H=c("[Favorites] Load Favorites Success",h()),O=c("[Favorites] Load Favorites Failure",h()),P=c("[Favorites] Add To Favorites",h()),z=c("[Favorites] Add To Favorites Success",h()),R=c("[Favorites] Add To Favorites Failure",h()),J=c("[Favorites] Remove From Favorites",h()),D=c("[Favorites] Remove From Favorites Success",h()),G=c("[Favorites] Remove From Favorites Failure",h()),M=c("[Favorites] Clear Favorites");var i={production:!1,apiUrl:"https://anapioficeandfire.com/api",backendUrl:"http://localhost:3000/api",appName:"Game of Thrones Character Explorer",itemsPerPage:10,enableLogging:!0,enableDevtools:!0};var Z=(()=>{let r=class r{constructor(t){this.http=t,this.baseUrl=i.apiUrl}getCharacters(t=1,e){let o=new x().set("page",t.toString()).set("pageSize",i.itemsPerPage.toString());return e&&(e.name&&(o=o.set("name",e.name)),e.gender&&(o=o.set("gender",e.gender)),e.culture&&(o=o.set("culture",e.culture)),e.born&&(o=o.set("born",e.born)),e.died&&(o=o.set("died",e.died)),e.isAlive!==void 0&&(o=o.set("isAlive",e.isAlive.toString()))),this.http.get(`${this.baseUrl}/characters`,{params:o,observe:"response"}).pipe(F(a=>{let S=a.body||[],A=a.headers.get("Link"),b=this.extractTotalFromLinkHeader(A)||S.length;return{data:S,total:b,page:t,pageSize:i.itemsPerPage,hasNext:t*i.itemsPerPage<b,hasPrev:t>1}}),n(a=>(console.error("Error fetching characters:",a),l({data:[],total:0,page:t,pageSize:i.itemsPerPage,hasNext:!1,hasPrev:!1}))))}getCharacterById(t){return this.http.get(`${this.baseUrl}/characters/${t}`).pipe(n(e=>{throw console.error("Error fetching character:",e),e}))}searchCharacters(t){let e={name:t};return this.getCharacters(1,e)}extractTotalFromLinkHeader(t){if(!t)return null;let e=t.match(/page=(\d+)[^>]*>;\s*rel="last"/);return e?parseInt(e[1],10)*i.itemsPerPage:null}extractCharacterIdFromUrl(t){let e=t.split("/");return e[e.length-1]||""}getCharacterDisplayName(t){if(t.name&&t.name.trim())return t.name;if(t.aliases&&t.aliases.length>0){let e=t.aliases.find(o=>o&&o.trim());if(e)return e}return"Unknown Character"}isCharacterAlive(t){return!t.died||t.died.trim()===""}};r.\u0275fac=function(e){return new(e||r)(d(m))},r.\u0275prov=v({token:r,factory:r.\u0275fac,providedIn:"root"});let s=r;return s})();var ot=(()=>{let r=class r{constructor(t){this.http=t,this.tokenKey="got-auth-token",this.userKey="got-user",this.isAuthenticatedSubject=new f(!1),this.currentUserSubject=new f(null),this.initializeAuth()}login(t){return this.http.post(`${i.backendUrl}/auth/login`,t).pipe(u(e=>this.handleAuthSuccess(e)),n(e=>{throw console.error("Login error:",e),e}))}register(t){return this.http.post(`${i.backendUrl}/auth/register`,t).pipe(u(e=>this.handleAuthSuccess(e)),n(e=>{throw console.error("Registration error:",e),e}))}logout(){this.removeToken(),this.removeUser(),this.isAuthenticatedSubject.next(!1),this.currentUserSubject.next(null)}getCurrentUser(){let t=this.getStoredUser();return t&&this.getToken()?(this.currentUserSubject.next(t),l(t)):this.getToken()?this.http.get(`${i.backendUrl}/auth/me`).pipe(u(e=>{this.setUser(e),this.currentUserSubject.next(e),this.isAuthenticatedSubject.next(!0)}),n(e=>{throw console.error("Error fetching current user:",e),this.logout(),e})):k(()=>"No authentication token found")}isAuthenticated(){return this.isAuthenticatedSubject.asObservable()}getToken(){try{return localStorage.getItem(this.tokenKey)}catch(t){return console.error("Error retrieving token:",t),null}}setToken(t){try{localStorage.setItem(this.tokenKey,t)}catch(e){console.error("Error storing token:",e)}}removeToken(){try{localStorage.removeItem(this.tokenKey)}catch(t){console.error("Error removing token:",t)}}handleAuthSuccess(t){this.setToken(t.token),this.setUser(t.user),this.isAuthenticatedSubject.next(!0),this.currentUserSubject.next(t.user)}setUser(t){try{localStorage.setItem(this.userKey,JSON.stringify(t))}catch(e){console.error("Error storing user:",e)}}getStoredUser(){try{let t=localStorage.getItem(this.userKey);return t?JSON.parse(t):null}catch(t){return console.error("Error retrieving stored user:",t),null}}removeUser(){try{localStorage.removeItem(this.userKey)}catch(t){console.error("Error removing user:",t)}}initializeAuth(){let t=this.getToken(),e=this.getStoredUser();t&&e&&(this.isAuthenticatedSubject.next(!0),this.currentUserSubject.next(e))}};r.\u0275fac=function(e){return new(e||r)(d(m))},r.\u0275prov=v({token:r,factory:r.\u0275fac,providedIn:"root"});let s=r;return s})();var ct=(()=>{let r=class r{constructor(t){this.http=t,this.localStorageKey="got-favorites",this.favoritesSubject=new f([]),this.useBackend=!1,this.loadFavoritesFromStorage()}getFavorites(){return this.useBackend?this.http.get(`${i.backendUrl}/favorites`).pipe(u(t=>this.favoritesSubject.next(t)),n(t=>(console.error("Error fetching favorites from backend:",t),this.getFavoritesFromStorage()))):this.getFavoritesFromStorage()}addToFavorites(t){return this.useBackend?this.http.post(`${i.backendUrl}/favorites`,t).pipe(u(()=>{let e=this.favoritesSubject.value;this.favoritesSubject.next([...e,t])}),n(e=>(console.error("Error adding to favorites on backend:",e),this.addToFavoritesLocally(t)))):this.addToFavoritesLocally(t)}removeFromFavorites(t){return this.useBackend?this.http.delete(`${i.backendUrl}/favorites/${encodeURIComponent(t)}`).pipe(u(()=>{let o=this.favoritesSubject.value.filter(a=>a.url!==t);this.favoritesSubject.next(o)}),n(e=>(console.error("Error removing from favorites on backend:",e),this.removeFromFavoritesLocally(t)))):this.removeFromFavoritesLocally(t)}isFavorite(t){return this.favoritesSubject.asObservable().pipe(F(e=>e.some(o=>o.url===t)))}clearFavorites(){return this.useBackend?this.http.delete(`${i.backendUrl}/favorites`).pipe(u(()=>{this.favoritesSubject.next([]),this.clearFavoritesFromStorage()}),n(t=>(console.error("Error clearing favorites on backend:",t),this.clearFavoritesLocally()))):this.clearFavoritesLocally()}setUseBackend(t){this.useBackend=t,t||this.loadFavoritesFromStorage()}getFavoritesFromStorage(){let t=this.loadFavoritesFromStorage();return this.favoritesSubject.next(t),l(t)}addToFavoritesLocally(t){let e=this.loadFavoritesFromStorage();if(!e.some(a=>a.url===t.url)){let a=[...e,t];this.saveFavoritesToStorage(a),this.favoritesSubject.next(a)}return l(void 0)}removeFromFavoritesLocally(t){let o=this.loadFavoritesFromStorage().filter(a=>a.url!==t);return this.saveFavoritesToStorage(o),this.favoritesSubject.next(o),l(void 0)}clearFavoritesLocally(){return this.clearFavoritesFromStorage(),this.favoritesSubject.next([]),l(void 0)}loadFavoritesFromStorage(){try{let t=localStorage.getItem(this.localStorageKey);return t?JSON.parse(t):[]}catch(t){return console.error("Error loading favorites from localStorage:",t),[]}}saveFavoritesToStorage(t){try{localStorage.setItem(this.localStorageKey,JSON.stringify(t))}catch(e){console.error("Error saving favorites to localStorage:",e)}}clearFavoritesFromStorage(){try{localStorage.removeItem(this.localStorageKey)}catch(t){console.error("Error clearing favorites from localStorage:",t)}}};r.\u0275fac=function(e){return new(e||r)(d(m))},r.\u0275prov=v({token:r,factory:r.\u0275fac,providedIn:"root"});let s=r;return s})();export{j as a,L as b,C as c,w as d,K as e,N as f,H as g,O as h,P as i,z as j,R as k,J as l,D as m,G as n,M as o,i as p,ot as q,Z as r,ct as s};
